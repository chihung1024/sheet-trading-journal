<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„äº¤æ˜“æ—¥è¨˜</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/naive-ui"></script>
    <style>
        body { background-color: #101014; color: #fff; margin: 0; font-family: sans-serif; padding-bottom: 50px; }
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .card { background: #18181c; padding: 20px; border-radius: 8px; border: 1px solid #2d2d30; margin-bottom: 20px; }
        .card-label { color: #888; font-size: 0.9em; margin-bottom: 5px; }
        .card-value { font-size: 1.6em; font-weight: bold; }
        .green { color: #63e2b7; }
        .red { color: #e88080; }
        .section-title { margin-bottom: 15px; color: #eee; border-left: 4px solid #63e2b7; padding-left: 10px; }
        
        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; font-size: 0.95em; }
        th { text-align: left; color: #888; padding: 12px; border-bottom: 1px solid #333; font-weight: normal; }
        td { padding: 12px; border-bottom: 1px solid #2d2d30; }
        tr:hover { background-color: #1f1f23; }
        .tag { padding: 3px 8px; background: #2d2d30; border-radius: 4px; font-size: 0.85em; font-weight: bold; }
    </style>
</head>
<body>
    <div id="app" class="container">
        <div class="header">
            <h2>ğŸ“ˆ æŠ•è³‡çµ„åˆçœ‹æ¿</h2>
            <span style="color: #666; font-size: 0.9em">æ›´æ–°: {{ updateTime }}</span>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-label">ç¸½è³‡ç”¢ (Net Worth)</div>
                <div class="card-value">${{ formatNumber(summary.total_value) }}</div>
            </div>
            <div class="card">
                <div class="card-label">ç¸½æç›Š (Total P&L)</div>
                <div class="card-value" :class="summary.total_pnl >= 0 ? 'red' : 'green'">
                    {{ summary.total_pnl >= 0 ? '+' : '' }}{{ formatNumber(summary.total_pnl) }}
                </div>
            </div>
            <div class="card">
                <div class="card-label">æœªå¯¦ç¾æç›Š (Unrealized)</div>
                <div class="card-value" :class="summary.unrealized_pnl >= 0 ? 'red' : 'green'">
                    {{ formatNumber(summary.unrealized_pnl) }}
                </div>
            </div>
            <div class="card">
                <div class="card-label">å·²å¯¦ç¾æç›Š (Realized)</div>
                <div class="card-value" :class="summary.realized_pnl >= 0 ? 'red' : 'green'">
                    {{ formatNumber(summary.realized_pnl) }}
                </div>
            </div>
        </div>

        <div class="card">
            <h3 class="section-title">ç›®å‰æŒå€‰ (Open Positions)</h3>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>ä»£ç¢¼</th>
                            <th>è‚¡æ•¸</th>
                            <th>å¹³å‡æˆæœ¬</th>
                            <th>ç¾åƒ¹</th>
                            <th>å¸‚å€¼</th>
                            <th>æœªå¯¦ç¾æç›Š</th>
                            <th>å ±é…¬ç‡</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="stock in holdings" :key="stock.symbol">
                            <td><span class="tag">{{ stock.symbol }}</span></td>
                            <td>{{ stock.qty }}</td>
                            <td>${{ stock.avg_price }}</td>
                            <td>${{ stock.current_price }}</td>
                            <td>${{ formatNumber(stock.market_value) }}</td>
                            <td :class="stock.pnl >= 0 ? 'red' : 'green'">
                                {{ stock.pnl >= 0 ? '+' : '' }}{{ formatNumber(stock.pnl) }}
                            </td>
                            <td :class="stock.pnl >= 0 ? 'red' : 'green'">
                                {{ stock.pnl_percent }}%
                            </td>
                        </tr>
                        <tr v-if="holdings.length === 0">
                            <td colspan="7" style="text-align: center; color: #666;">ç›®å‰æ²’æœ‰æŒå€‰</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <h3 class="section-title">å·²å¹³å€‰ç´€éŒ„ (Closed Positions)</h3>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>ä»£ç¢¼</th>
                            <th>é–‹å€‰æ—¥</th>
                            <th>å¹³å€‰æ—¥</th>
                            <th>è²·å…¥åƒ¹</th>
                            <th>è³£å‡ºåƒ¹</th>
                            <th>è‚¡æ•¸</th>
                            <th>ç²åˆ©é‡‘é¡</th>
                            <th>å ±é…¬ç‡</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="deal in closedPositions" :key="deal.symbol + deal.close_date">
                            <td><span class="tag">{{ deal.symbol }}</span></td>
                            <td style="color: #888">{{ deal.open_date }}</td>
                            <td>{{ deal.close_date }}</td>
                            <td>${{ deal.buy_price }}</td>
                            <td>${{ deal.sell_price }}</td>
                            <td>{{ deal.qty }}</td>
                            <td :class="deal.pnl >= 0 ? 'red' : 'green'" style="font-weight: bold;">
                                {{ deal.pnl >= 0 ? '+' : '' }}{{ formatNumber(deal.pnl) }}
                            </td>
                            <td :class="deal.pnl >= 0 ? 'red' : 'green'">
                                {{ deal.pnl_percent }}%
                            </td>
                        </tr>
                        <tr v-if="closedPositions.length === 0">
                            <td colspan="8" style="text-align: center; color: #666;">ç›®å‰æ²’æœ‰å¹³å€‰ç´€éŒ„</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue
        
        createApp({
            setup() {
                const summary = ref({ total_value: 0, total_pnl: 0, unrealized_pnl: 0, realized_pnl: 0 })
                const updateTime = ref('-')
                const holdings = ref([])
                const closedPositions = ref([])
                
                const formatNumber = (num) => {
                    if (num === undefined || num === null) return '0.00'
                    return Number(num).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
                }

                const fetchData = async () => {
                    try {
                        const res = await fetch('data.json?t=' + new Date().getTime())
                        const data = await res.json()
                        
                        summary.value = data.summary
                        updateTime.value = data.updated_at
                        holdings.value = data.holdings
                        closedPositions.value = data.closed_positions
                    } catch (e) {
                        console.error("è®€å–ä¸­...", e)
                    }
                }

                onMounted(fetchData)
                return { summary, updateTime, holdings, closedPositions, formatNumber }
            }
        }).mount('#app')
    </script>
</body>
</html>
